@model Informa.Web.ViewModels.Casualty.AdobeChartViewModel
@if (Model.IsUserAuthenticated)
{
    

}
@{
    var AMGraph = Model.GraphDetail;
}
<script src="//www.amcharts.com/lib/3/amcharts.js" type="text/javascript"></script>
<script src="//www.amcharts.com/lib/3/serial.js" type="text/javascript"></script>
<script src="//www.amcharts.com/lib/3/amstock.js" type="text/javascript"></script>
<div id="@AMGraph.GraphID">@AMGraph.GraphTitle</div>

<script>
    var graphcolor = '@AMGraph.GraphColor';
    var graphType = '@AMGraph.GraphType'
    var chartData = [];
			AmCharts.ready(function () {
				generateChartData();
				createStockChart();
			});


			function generateChartData() {
			    var testdata = '@AMGraph.FinanceResult';
			    var graphdata = testdata.split("|");
			    for (var i = 0; i<= graphdata.length; i++) {
			        if (graphdata[i] != undefined && graphdata[i].indexOf(",") > 0) {
			            var year = graphdata[i].split(",")[0];
			            var val = graphdata[i].split(",")[1];
			            chartData.push({
			                date: year,
			                value: val,
			            });
			        }
			    }
			}

   
            var chart;

            function createStockChart() {
                chart = new AmCharts.AmStockChart();


                // DATASETS //////////////////////////////////////////
                var dataSet = new AmCharts.DataSet();
                dataSet.color = "#b0de09";
                dataSet.title = "@AMGraph.GraphID";
                dataSet.fieldMappings = [{
                    fromField: "value",
                    toField: "value"
                }];
                dataSet.dataProvider = chartData.reverse();
                dataSet.categoryField = "date";
                console.log(chartData);
                // set data sets to the chart
                chart.dataSets = [dataSet];

                // PANELS ///////////////////////////////////////////
                // first stock panel
                var stockPanel1 = new AmCharts.StockPanel();
                stockPanel1.showCategoryAxis = false;
                stockPanel1.title = "Value";
                stockPanel1.percentHeight = 70;

                // graph of first stock panel
                var graph1 = new AmCharts.StockGraph();
                graph1.valueField = "value";
                graph1.comparable = true;
                graph1.compareField = "value";
                graph1.bullet = "round";
                graph1.bulletBorderColor = "#FFFFFF";
                graph1.bulletBorderAlpha = 1;
                graph1.balloonText = "[[title]]:<b>[[value]]</b>";
                graph1.compareGraphBalloonText = "[[title]]:<b>[[value]]</b>";
                graph1.compareGraphBullet = "round";
                graph1.compareGraphBulletBorderColor = "#FFFFFF";
                graph1.compareGraphBulletBorderAlpha = 1;
                stockPanel1.addStockGraph(graph1);

                // create stock legend
                var stockLegend1 = new AmCharts.StockLegend();
                stockLegend1.markerType = "none";
                stockLegend1.periodValueTextRegular = "[[value.close]]";
                stockPanel1.stockLegend = stockLegend1;




                // set panels to the chart
                chart.panels = [stockPanel1];


                // OTHER SETTINGS ////////////////////////////////////
                var scrollbarSettings = new AmCharts.ChartScrollbarSettings();
                scrollbarSettings.graph = graph1;
                scrollbarSettings.updateOnReleaseOnly = false;
                chart.chartScrollbarSettings = scrollbarSettings;

                var cursorSettings = new AmCharts.ChartCursorSettings();
                cursorSettings.valueBalloonsEnabled = true;
                cursorSettings.graphBulletSize = 1;
                chart.chartCursorSettings = cursorSettings;


                // PERIOD SELECTOR ///////////////////////////////////
                var periodSelector = new AmCharts.PeriodSelector();
                periodSelector.periods = [{
                    period: "DD",
                    count: 10,
                    label: "10 days"
                }, {
                    period: "MM",
                    count: 1,
                    label: "1 month"
                }, {
                    period: "YYYY",
                    count: 1,
                    selected: true,
                    label: "1 year"
                }, {
                    period: "MAX",
                    label: "MAX"
                }];
                chart.periodSelector = periodSelector;


                var panelsSettings = new AmCharts.PanelsSettings();
                panelsSettings.marginRight = 16;
                panelsSettings.marginLeft = 16;
                panelsSettings.usePrefixes = true;
                chart.panelsSettings = panelsSettings;




                chart.write('chartdiv');
            }
</script>

 <h1>Stock Chart1</h1>
<div style="margin:5px;">
    <div id="chartdiv" style="width:760px; height:300px;"></div>
</div>

