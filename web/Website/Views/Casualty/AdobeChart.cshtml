@model Informa.Web.ViewModels.Casualty.AdobeChartViewModel

@{
    var AMGraph = Model.GraphDetail;
}
<script src="//www.amcharts.com/lib/3/amcharts.js" type="text/javascript"></script>
<script src="//www.amcharts.com/lib/3/serial.js" type="text/javascript"></script>
<script src="//www.amcharts.com/lib/3/amstock.js" type="text/javascript"></script>
<div>
    <b><span id="@AMGraph.GraphID">@AMGraph.GraphTitle</span></b>
</div>

<script>
    var graphcolor = '@AMGraph.GraphColor';
    var graphType = '@AMGraph.GraphType'
    var chartData = [];
			AmCharts.ready(function () {
				generateChartData();
				createStockChart();
				setTimeout(function () { $("a[title='JavaScript charts']").hide() }, 600);
				CalculateDifference();
			});

			function CalculateDifference() {
			    var LatestItem = chartData[chartData.length - 1].value,
			        SecondLastItem = chartData[chartData.length - 2].value,
			        Difference = LatestItem - SecondLastItem;
			    LatestDate = chartData[chartData.length - 1].date;
			    var status = "";
			    if (Difference > 0) {
			        status = "rise";
			    } else {
			        status = "fall";
			    }
			    $('#latest-value').html(LatestItem + '<span class="' + status + '">(' + Difference + ')</span> <span>' + LatestDate + '</span>');

			}

			function generateChartData() {
			    var testdata = '@AMGraph.FinanceResult';
			    var graphdata = testdata.split("|");
			    for (var i = 0; i<= graphdata.length; i++) {
			        if (graphdata[i] != undefined && graphdata[i].indexOf(",") > 0) {
			            var year = graphdata[i].split(",")[0];
			            var val = graphdata[i].split(",")[1];
			            chartData.push({
			                date: year,
			                value: val,
			            });
			        }
			    }

			}


            var chart;

            function createStockChart() {
                chart = new AmCharts.AmStockChart();


                // DATASETS //////////////////////////////////////////
                var dataSet = new AmCharts.DataSet();
                dataSet.color = "#"+"@AMGraph.GraphColor";
                dataSet.title = "@AMGraph.GraphID";
                dataSet.fieldMappings = [{
                    fromField: "value",
                    toField: "value"
                }];
                dataSet.dataProvider = chartData.reverse();
                dataSet.categoryField = "date";
                console.log(chartData);
                // set data sets to the chart
                chart.dataSets = [dataSet];

                // PANELS ///////////////////////////////////////////
                // first stock panel
                var stockPanel1 = new AmCharts.StockPanel();
                stockPanel1.showCategoryAxis = true;
                stockPanel1.title = "Value";
                stockPanel1.percentHeight = 70;

                // graph of first stock panel
                var graph1 = new AmCharts.StockGraph();
                graph1.valueField = "value";
                graph1.type = "@AMGraph.GraphType";
                graph1.graphl
                graph1.comparable = true;
                graph1.compareField = "value";
                graph1.bullet = "round";
                graph1.bulletBorderColor = "#FFFFFF";
                graph1.bulletBorderAlpha = 1;
                graph1.balloonText = "[[title]]:<b>[[value]]</b>";
                graph1.compareGraphBalloonText = "[[title]]:<b>[[value]]</b>";
                graph1.compareGraphBullet = "round";
                graph1.compareGraphBulletBorderColor = "#FFFFFF";
                graph1.compareGraphBulletBorderAlpha = 1;
                stockPanel1.addStockGraph(graph1);

                // create stock legend
                var stockLegend1 = new AmCharts.StockLegend();
                stockLegend1.markerType = "none";
                stockLegend1.periodValueTextRegular = "[[value.close]]";
                stockPanel1.stockLegend = stockLegend1;




                // set panels to the chart
                chart.panels = [stockPanel1];


                // OTHER SETTINGS ////////////////////////////////////
                var scrollbarSettings = new AmCharts.ChartScrollbarSettings();
                scrollbarSettings.graph = graph1;
                scrollbarSettings.updateOnReleaseOnly = false;
                chart.chartScrollbarSettings = scrollbarSettings;

                var cursorSettings = new AmCharts.ChartCursorSettings();
                cursorSettings.valueBalloonsEnabled = true;
                cursorSettings.graphBulletSize = 1;
                cursorSettings.selectedBackgroundColor = "#FFB6C1";
                
                chart.chartCursorSettings = cursorSettings;


                // PERIOD SELECTOR ///////////////////////////////////
                var periodSelector = new AmCharts.PeriodSelector();
                periodSelector.fromText = "Custom period";
                periodSelector.toText = "-";
                periodSelector.periods = [{
                        period: "YYYY",
                        count: 1,
                        selected: true,
                        label: "1Y"
                    },{
                        period: "MM",
                        count: 6,
                        label: "6M"
                    },{
                        period: "MM",
                        count: 1,
                        label: "1M"
                    },{
                    period: "DD",
                    count: 7,
                    label: "1W"
                    }, {
                    period: "MAX",
                    label: "MAX"
                   }];
                chart.periodSelector = periodSelector;


                var panelsSettings = new AmCharts.PanelsSettings();
                panelsSettings.marginRight = 16;
                panelsSettings.marginLeft = 16;
                panelsSettings.usePrefixes = true;
                chart.panelsSettings = panelsSettings;
                chart.write('chartdiv');
            }
</script>
<style>
    .amcharts-period-input-selected{background: darkturquoise;
    font-weight: bold;}
</style>
 <b><p id="latest-value"></p></b>
 <div id="chartdiv" style="height:350px;margin-bottom:30px;"></div>


