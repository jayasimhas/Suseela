@inherits CustomGlassView<SideNavigationMenuViewModel>
@using Informa.Web.ViewModels;
@using Informa.Library.Navigation;

<div class="main-menu js-full-menu-toggle">
    <div class="menu-toggler js-menu-toggle-button">
        <button class="menu-toggler__button">
            <span>@Model.MenuButtonText</span>
        </button>
        @Model.MenuText
    </div>
    @if (Model.Navigation != null)
    {
        var Nav = new Navigation();
        foreach (var navigation in Model.Navigation.Where(n => !(n.Link == null && !n.Children.Any())))
        {
            Nav.Children = new List<Navigation>();
            IEnumerable<INavigation> ChildrenListTop = new List<Navigation>();
            IEnumerable<INavigation> ChildrenListBottom = new List<Navigation>();
            if (Model.NavigationWithSubs != null)
            {
                ChildrenListTop = navigation.Children.Where(m => Model.NavigationWithSubs.Any(n => n.Publication == m.Text));
                ChildrenListBottom = navigation.Children.Where(m => !Model.NavigationWithSubs.Any(n => n.Publication == m.Text));
                Nav.Children = ChildrenListTop.Concat(ChildrenListBottom);
            }
            else
            {
                Nav.Children = navigation.Children;
            }
            if (string.Equals(navigation.Text, "My View", StringComparison.OrdinalIgnoreCase))
            {
                Model.Preferencelst = Model.MyViewPreferences;
                if (Model.Preferencelst != null)
                {
                    Nav.Children = Model.Preferencelst.Children;
                }
            }
            if (navigation.Link == null && navigation.Text == null && Nav.Children.Any())
            {
                <dl class="main-menu__footer">
                    @foreach (var navigationChild in Nav.Children)
                    {
                        <dd class="main-menu__footer-link">
                            <a href="@navigationChild.Link.Url" target="@navigationChild.Link.Target">@navigationChild.Text</a>
                        </dd>
                    }
                    <dd class="bottomSpace"></dd>
                    <dd class="bottomSpace"></dd>
                    <dd class="bottomSpace"></dd>
                    <dd class="bottomSpace"></dd>
                    <dd class="bottomSpace"></dd>

                </dl>
            }
            else if (string.Equals(navigation.Text, "My View", StringComparison.OrdinalIgnoreCase))
            {
                <div class="main-menu__section">
                    <div class="titleMyView">@navigation.Text</div>
                    <ul>
                        <li class="edit-link"><a href="javascript: void(0);">@Model.MyViewEditBtnText</a></li>
                        <li class="navContent">@Model.MyViewHelpText</li>
                        @if (Nav.Children.Any())
                        {
                            foreach (var navigationChild in Nav.Children)
                            {
                                <li class="main-menu__hoverable">
                                    <a href="@navigationChild.Link.Url" target="@navigationChild.Link.Target" class="main-menu__section-link">@navigationChild.Text</a>
                                </li>
                            }
                        }
                    </ul>
                </div>
            }
            else
            {
                <ul class="main-menu__section">
                    <li class="main-menu__section-title main-menu__hoverable js-toggle-menu-section is-active">
                        @if (Nav.Children.Any())
                        {
                            <svg class="main-menu__arrow-icon  js-hoist-menu-click">
                                <use xlink:href="/dist/img/svg-sprite.svg#down-arrow"></use>
                            </svg>
                        }
                        @if (navigation.Link == null)
                        {
                            @navigation.Text
                        }
                        else
                        {
                            <a href="@navigation.Link.Url" target="@navigation.Link.Target">@navigation.Text</a>
                        }
                    </li>

                    @if (Nav.Children.Any())
                    {
                        <li class="main-menu__section-wrapper">
                            <ul>
                                @foreach (var navigationChild in Model.Preferencelst != null ? Nav.Children.Where(p => !Model.Preferencelst.Children.Any(p2 => p2.Text == p.Text)) : Nav.Children)
                                {
                                    <li class="main-menu__hoverable">
                                        <a href="@navigationChild.Link.Url" target="@navigationChild.Link.Target" class="main-menu__section-link">@navigationChild.Text</a>
                                    </li>
                                }
                            </ul>
                        </li>
                    }
                </ul>
            }
        }
    }
</div>
