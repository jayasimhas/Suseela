@inherits CustomGlassView<Informa.Web.ViewModels.Emails.FeaturedArticleMultiColumnViewModel>
@using Informa.Library.Search.Utilities
@using Informa.Library.Utilities.References
@using Informa.Web.ViewModels.Emails
@using Informa.Models.Informa.Models.sitecore.templates.User_Defined.Objects


@if (Model != null && Model.RenderingParameters != null && Model.RenderingParameters.Display_Option != null && !string.IsNullOrWhiteSpace(Model.RenderingParameters.Display_Option.Value))
{

    if (Model.RenderingParameters.Display_Option.Value == Constants.ArticleDisplayModeTypes.FeaturedArticleFullRow)
    {
	
        <!--100% Width full tile with grey background-->
        
        <table class="manual-curated-email-section manual-featured-article" border="0" width="100%" cellpadding="0" cellspacing="0" style="background-color:#@GetBackgroundColor(Model);" >
            @if (Model != null && Model.GlassModel != null && !Model.GlassModel.DisableTagLine && Model.Articles.ToList().Count > 0)
            {
                <tr>
                    <td style="padding-bottom:0;">
                        <table border="0"  cellpadding="0" cellspacing="0" width="100%">
                            <tr>
							<td style="padding-top:15px; padding-bottom:0;">
								<div class="article-metadata" style="width:100%;">
                                @if (Model.Articles[0].Actual_Publish_Date != null)
                                {
									
                                   
                                        <span class="article-date">@Model.Articles[0].Actual_Publish_Date.ToString("dd MMM yyyy")</span>
                                        <span>&nbsp;</span><span class="vertical-separator" style="color:#ddd; font-size:16px;">|</span><span>&nbsp;</span>
                                    
                                }
                                @if (Model.Articles[0].Content_Type != null)
                                {
									
                                    
                                        <span class="article-category">@Model.Articles[0].Content_Type.Item_Name<span>&nbsp;</span><span class="vertical-separator">|</span><span>&nbsp;</span></span>
                                    
                                }
                                @if (Model.Articles != null && Model.Articles.Any() && Model.Articles[0].Media_Type != null &&
                                    Model.Articles[0].Media_Type.Media_Type_Icon != null && !string.IsNullOrWhiteSpace(Model.Articles[0].Media_Type.Media_Type_Icon.Src))
                                {
                                    <span class="article-content-type" >
                                        <span class="js-toggle-tooltip" data-tooltip-text="This article includes data.">
                                            <img class="" src="@Model.Articles[0].Media_Type.Media_Type_Icon.Src" width="25" />
                                        </span>
                                        <span>&nbsp;</span><span class="vertical-separator" style="color:#ddd; font-size:16px;">|</span><span>&nbsp;</span>
                                    </span>
                                }
                                @if (Model.Articles[0] != null && Model.Articles[0].Taxonomies != null && Model.Articles[0].Taxonomies.Any())
                                {
                                    int count = 0;
                                    if (Model.Articles[0].Taxonomies.ToList().Count > 2)
                                    {
                                        foreach (var taxonomyItem in Model.Articles[0].Taxonomies.Take(2))
                                        {
                                            <span align="center" class="visible-desk">
                                                <a href="@GetTaxonomyUrl(taxonomyItem)" style="-ms-text-size-adjust:100%;-webkit-text-size-adjust:100%;color: #be1e2d; text-decoration: none;">@taxonomyItem.Item_Name<span class="vertical-separator">|</span></a>
                                                @if (count == 0)
                                                {
                                                    count++;
                                                    <span>&nbsp;</span><span class="vertical-separator" style="color:#ddd; font-size:16px;">|</span><span>&nbsp;</span>
                                                }
                                            </span>
                                        }
                                    }
                                    else
                                    {
                                        foreach (var taxonomyItem in Model.Articles[0].Taxonomies)
                                        {
                                            <span align="center" class="visible-desk" style="-ms-text-size-adjust:100%;-webkit-text-size-adjust:100%;list-style:none;-ms-flex-item-align:center;align-self:center;-webkit-box-flex:0;-ms-flex:0 0 auto;flex:0 0 auto;margin-right:12px;margin-right:0.75rem;margin-left:0;padding-right:12px;padding-right:0.75rem;position:relative;list-style: none;">
                                                <a href="@GetTaxonomyUrl(taxonomyItem)" style="-ms-text-size-adjust:100%;-webkit-text-size-adjust:100%;color: #be1e2d; text-decoration: none;">@taxonomyItem.Item_Name</a>
                                                @if (count == 0)
                                                {
                                                    count++;
                                                    <span>&nbsp;</span><span class="vertical-separator" style="color:#ddd; font-size:16px;">|</span><span>&nbsp;</span>
                                                }
                                            </span>
                                        }
                                    }
                                }
								</div>
								</td>
                            </tr>
                        </table>
                    </td>
                </tr>
            }

            <tr>
                <td colspan="6" style="padding-left:15px; padding-bottom:0; padding-top:0;">
                    
                        <a href="@Model.Articles[0]._Url" > <h3 class="featured__title">@Model.Articles[0].Title </h3></a>
                    
                </td>
            </tr>
            <tr>
                <td colspan="6" style="padding-left:15px; padding-right:15px;">
                    <table  width="100%" border="0" cellpadding="0" cellspacing="0">
                        <tr>
                            @if (Model.Articles[0].Featured_Image_16_9 != null)
                            {
                                <td rowspan="2"class="one-third layout-padded-right" ><a href="@Model.Articles[0]._Url"><img  src="@Model.Articles[0].Featured_Image_16_9.Src" /></a></td>
                            }
							
                            @if ((Model.GlassModel.ShowGreyBackground || Model.GlassModel.ShowPinkBackground) && !Model.GlassModel.HideAuthorByLine)
                            {
                                <td > 
									<span class="article-byline">@Html.Raw(Model.Byline)</span>
								</td>
                            }
                        </tr>
                        <tr>
                            <td >@((Model.ShortDescrpitons != null && !string.IsNullOrWhiteSpace(Model.ShortDescrpitons[0])) ? Editable(Model, m => m.ShortDescrpitons[0]) : Editable(Model, m => m.Articles[0].Summary))</td>
                        </tr>
                    </table>
                </td>
            </tr>
            <tr class="visible-mob" style="display: none;">
                @if (Model.Articles[0] != null && Model.Articles[0].Taxonomies != null && Model.Articles[0].Taxonomies.Any())
                {
                    if (Model.Articles[0].Taxonomies.ToList().Count > 2)
                    {
                        foreach (var taxonomyItem in Model.Articles[0].Taxonomies.Take(2))
                        {
                            <td align="center">
                                <a href="@GetTaxonomyUrl(taxonomyItem)" style="-ms-text-size-adjust:100%;-webkit-text-size-adjust:100%;color: #be1e2d; text-decoration: none; font-size: 13px;">@taxonomyItem.Item_Name<span class="vertical-separator">|</span></a>
                            </td>
                        }
                    }
                    else
                    {
                        foreach (var taxonomyItem in Model.Articles[0].Taxonomies)
                        {
                            <td align="center" style="-ms-text-size-adjust:100%;-webkit-text-size-adjust:100%;list-style:none;-ms-flex-item-align:center;align-self:center;-webkit-box-flex:0;-ms-flex:0 0 auto;flex:0 0 auto;margin-left:0;position:relative;list-style: none;">
                                <a href="@GetTaxonomyUrl(taxonomyItem)" style="-ms-text-size-adjust:100%;-webkit-text-size-adjust:100%;color: #be1e2d; text-decoration: none; font-size: 13px;">@taxonomyItem.Item_Name</a>
                                <span class="vertical-separator">|</span>
                            </td>
                        }
                    }
                }
            </tr>
</table>
        <table border="0" cellpadding="0" cellspacing="0" width="100%">
            <tr>
               <td> &nbsp;</td>
            </tr>
        </table>

    }
    if (Model.Articles != null && Model.Articles.Any() &&
       (Model.RenderingParameters.Display_Option.Value == Constants.ArticleDisplayModeTypes.FeaturedArticleHalfRow ||
       Model.RenderingParameters.Display_Option.Value == Constants.ArticleDisplayModeTypes.FeaturedArticleThreeRows))
    {
        if (Sitecore.Context.PageMode.IsExperienceEditorEditing && !Sitecore.Context.PageMode.IsPreview)
        {
            @Html.Raw(GetStartTag())
        }
        if (Model.RenderingParameters.Display_Option.Value == Constants.ArticleDisplayModeTypes.FeaturedArticleHalfRow)
        {
            if (!Sitecore.Context.PageMode.IsExperienceEditorEditing)
            {
                @Html.Raw(GetStartTag())
            }
                <td width="47%" align="top" class="full-mob" style="vertical-align: top;">
                    <table width="100%" border="0" height="320" cellpadding="10" cellspacing="0">
                        <tbody>
                            <tr>
                                <td style="padding-left:15px;">
                                    @foreach (var article in Model.Articles)
                                    {
                                        if (article != null)
                                        {
                                    <table width="100%" border="0" cellpadding="0" cellspacing="0"  height="160" style="border-bottom:1px solid #CCC; margin-bottom:15px; padding-bottom:15px;">
                                        <tbody>
                                            @if (Model.GlassModel != null && !Model.GlassModel.DisableTagLine)
                                            {
                                    <tr>
                                        <td valign="middle" style="vertical-align: top;">
                                            <table width="100%" border="0" cellpadding="0" cellspacing="0">
                                                <tbody>
                                                    <tr>
														<td valign="top" >
														<div class="article-metadata">
                                                        @if (article.Actual_Publish_Date != null)
                                                        {
                                                            <span class="article-date"> @article.Actual_Publish_Date.ToString("dd MMM yyyy")</span>
                                                            <span>&nbsp;</span><span class="vertical-separator" style="color:#ddd; font-size:16px;">|</span><span>&nbsp;</span>
                                                       
                                                        }
                                                        @if (Model.Articles[0].Content_Type != null)
                                                        {
                                                        <span class="article-category" valign="middle">
                                                            @Model.Articles[0].Content_Type.Item_Name
                                                        </span>
                                                        }
														</div>
														</td>
                                                    </tr>
                                                </tbody>
                                            </table>
                                        </td>
                                    </tr>
                                            }
                                            <tr>
                                                <td valign="top" >
                                                    
                                                        <a href="@article._Url"><h3 class="featured__title"> @article.Title</h3></a>
                                                    
                                                </td>
                                            </tr>

                                            @if (Model.GlassModel != null && !Model.GlassModel.DisableMetaTags)
                                            {
                                    <tr>
                                        <td valign="top" style="padding-bottom:15px;">
                                            <table  border="0" cellpadding="0" cellspacing="0">
                                                <tbody>
                                                    <tr>
                                                        @if (article.Taxonomies != null)
                                                        {
                                                            int count = 0;
                                                            if (article.Taxonomies.ToList().Count > 2)
                                                            {
                                                                foreach (var taxonomyItem in article.Taxonomies.Take(2))
                                                                {
                                                                    <td>
                                                                        <a style="color:#be1e2d;text-decoration:none;" href="@GetTaxonomyUrl(taxonomyItem)">@taxonomyItem.Item_Name</a>
                                                                        @if (count == 0)
                                                                        {
                                                                            count++;
                                                                            <span>&nbsp;</span><span class="vertical-separator" style="color:#ddd; font-size:16px;">|</span><span>&nbsp;</span>
                                                                        }
                                                                    </td>
                                                                }
                                                            }
                                                            else
                                                            {
                                                                foreach (var taxonomyItem in article.Taxonomies)
                                                                {
                                                                    <td>
                                                                        <a style="color:#be1e2d;text-decoration:none;" href="@GetTaxonomyUrl(taxonomyItem)">@taxonomyItem.Item_Name</a>
                                                                        @if (count == 0)
                                                                        {
                                                                            count++;
                                                                            <span>&nbsp;</span><span class="vertical-separator" style="color:#ddd; font-size:16px;">|</span><span>&nbsp;</span>
                                                                        }
                                                                    </td>
                                                                }
                                                            }
                                                        }
                                                    </tr>
                                                </tbody>
                                            </table>
                                        </td>
                                    </tr>
									
									
                                            }

                                        </tbody>
                                    </table>
                                        }
                                    }
                                </td>
                            </tr>
                        </tbody>
                    </table>
                </td>
        }

        if (Model.RenderingParameters.Display_Option.Value == Constants.ArticleDisplayModeTypes.FeaturedArticleThreeRows)
        {
            int index = 0;
                   <td width="5%">&nbsp;</td>      
                <td width="47%" align="top" class="full-mob">
                    <table class="manual-featured-article" width="100%" height="320" border="0" cellpadding="0" cellspacing="0">
                        <tbody>
                            <tr>
                                <td valign="top">
                                    <table width="100%" style=" border-collapse: separate;" cellpadding="10" border="0" cellspacing="0">
                                        <tbody>
                                            <tr>
                                                <td style="border-bottom:2px solid #ccc; border-top:2px solid #ccc; background: #f1f2f2;">
                                                    @foreach (var article in Model.Articles)
                                                    {
                                                        if (article != null)
                                                        {
                                                            <table border="0" width="100%" cellpadding="0" height="100" style="@(index != 2 ? "border-bottom:1px solid #ccc;" : string.Empty)">
                                                                <tr>
                                                                    <td>
                                                                        <a href="@article._Url">
                                                                            <h3 style="margin: 0;" class="featured__title">
                                                                                @article.Title
                                                                            </h3>
                                                                        </a>
                                                                    </td>
                                                                </tr>
                                                            </table>
                                                        }
                                                        index++;
                                                    }
                                                </td>
                                            </tr>
                                        </tbody>
                                    </table>
                                </td>
                            </tr>
                        </tbody>
                    </table>
                </td>

               if (!Sitecore.Context.PageMode.IsExperienceEditorEditing)
            {
                @Html.Raw(GetEndTag())
            }
        }
        if (Sitecore.Context.PageMode.IsExperienceEditorEditing && !Sitecore.Context.PageMode.IsPreview)
        {
            @Html.Raw(GetEndTag())
        }
        }

    if (Model.RenderingParameters.Display_Option.Value == Constants.ArticleDisplayModeTypes.FeaturedArticleTwoColumn && Model.Articles != null && Model.Articles.Any())
    {
        int index = 0;
        <table border="0" cellpadding="0" cellspacing="0" width="100%">
            <tr>
                <td>&nbsp;</td>
            </tr>
        </table>
        <table border="0" width="100%" cellpadding="0" cellspacing="0" style="border-bottom: 1px solid #ccc;" >
            <tbody>
                <tr>
                    @foreach (var article in Model.Articles)
                    {
                        if (article != null && index < 2)
                        {
                            <td valign="top" class="full-mob" width="47%">
                                <table  border="0"  style="border-collapse: separate;" cellpadding="0" cellspacing="0">
                                    <tbody>
                                        @if (Model.GlassModel != null && !Model.GlassModel.DisableTagLine)
                                        {
                                            <tr>
                                                <td valign="top">
                                                    <table width="100%" border="0" cellpadding="0" cellspacing="0">
                                                        <tbody>
                                                            <tr>
																<td valign="top" style="padding-left:15px;">
																<div class="article-metadata" >
                                                                @if (article.Actual_Publish_Date != null)
                                                                {
                                                                    
                                                                        <span class="article-date">@article.Actual_Publish_Date.ToString("dd MMM yyyy")</span>
                                                                        <span>&nbsp;</span><span class="vertical-separator" style="color:#ddd; font-size:16px;">|</span><span>&nbsp;</span>
                                                                   
                                                                }
                                                                @if (article.Content_Type != null)
                                                                {
                                                                   <span class="article-category">
                                                                        @article.Content_Type.Item_Name</span>
                                                                        <span>&nbsp;</span><span class="vertical-separator" style="color:#ddd; font-size:16px;">|</span><span>&nbsp;</span>
                                                                    
                                                                }
                                                                @if (article.Media_Type != null && article.Media_Type.Media_Type_Icon != null &&
                                                                    !string.IsNullOrWhiteSpace(article.Media_Type.Media_Type_Icon.Src))
                                                                {
                                                                    <span class="article-content-type">
                                                                            <img class="" src="@article.Media_Type.Media_Type_Icon.Src" width="25" />
                                                                        </span>
                                                                    
                                                                }
																</div>
																</td>
                                                            </tr>
                                                        </tbody>
                                                    </table>
                                                </td>
                                            </tr>
                                        }
										
                                        <tr>
                                            <td valign="top" style="padding-left:15px;">
                                                <a href="@article._Url" ><h3 style="height: 50px;" class="featured__title">
                                                    @article.Title
                                                </h3>
												</a>
                                            </td>
                                        </tr>
										
                                        <tr>
                                            <td valign="top" height="120px" style="padding-left:15px;">
                                                <div style="height:120px;">
                                                    <p>@((Model.ShortDescrpitons != null && !string.IsNullOrWhiteSpace(Model.ShortDescrpitons[index])) ? Editable(Model, m => m.ShortDescrpitons[index]) : Editable(article, m => m.Summary))</p>
                                                </div>
                                            </td>
                                        </tr>

                                        @if (Model.GlassModel != null && !Model.GlassModel.DisableMetaTags)
                                        {
                                            <tr>
                                                <td valign="middle" style="padding-left:15px;">
                                                    <table border="0"  cellpadding="0" cellspacing="0">
                                                        <tbody>
                                                            <tr>
                                                                @if (article.Taxonomies != null)
                                                                {
                                                                    int count = 0;
                                                                    if (article.Taxonomies.ToList().Count > 2)
                                                                    {
                                                                        foreach (var taxonomyItem in article.Taxonomies.Take(2))
                                                                        {
                                                                            <td>
                                                                                <a style="color:#be1e2d; text-decoration:none;" href="@GetTaxonomyUrl(taxonomyItem)">@taxonomyItem.Item_Name</a>
                                                                                @if (count == 0)
                                                                                {
                                                                                    count++;
                                                                                    <span>&nbsp;</span><span class="vertical-separator" style="color:#ddd; font-size:16px;">|</span><span>&nbsp;</span>
                                                                                }
                                                                            </td>
                                                                        }
                                                                    }
                                                                    else
                                                                    {
                                                                        foreach (var taxonomyItem in article.Taxonomies)
                                                                        {
                                                                            <td>
                                                                                <a style="color:#be1e2d; text-decoration:none;" href="@GetTaxonomyUrl(taxonomyItem)">@taxonomyItem.Item_Name</a>
                                                                                @if (count == 0)
                                                                                {
                                                                                    count++;
                                                                                    <span>&nbsp;</span><span class="vertical-separator" style="color:#ddd; font-size:16px;">|</span><span>&nbsp;</span>
                                                                                }
                                                                            </td>
                                                                        }
                                                                    }
                                                                }
                                                                
                                                            </tr>
                                                        </tbody>
                                                    </table>
                                                </td>
                                            </tr>
											<tr><td>&nbsp;</td></tr>
                                        }

                                    </tbody>
                                </table>
                            </td>
							<td width="5%">&nbsp;</td>
                            index++;
                        }
                    }
                </tr>
				
            </tbody>
        </table>
        <table border="0"  cellpadding="0" cellspacing="0">
            <tr>
                <td>&nbsp;</td>
            </tr>
        </table>
    }

}

@functions
{
    public string GetBackgroundColor(FeaturedArticleMultiColumnViewModel model)
    {
        if (model.GlassModel.ShowGreyBackground)
            return "f1f2f2";
        else if (model.GlassModel.ShowPinkBackground)
            return "f9e5e6";
        else
            return "ffffff";
    }

    public string GetStartTag()
    {
        return @"<table border='0' cellpadding='0' cellspacing='0' width='100%'><tr>";
    }

    public string GetEndTag()
    {
        return "</tr></table>";
    }

    public string GetTaxonomyUrl(ITaxonomy_Item taxonomyItem)
    {
        return $"{HttpContext.Current.Request.Url.Scheme}://{HttpContext.Current.Request.Url.Authority}{HttpContext.Current.Request.ApplicationPath.TrimEnd('/')}{SearchTaxonomyUtil.GetSearchUrl(taxonomyItem)}";
    }
}
